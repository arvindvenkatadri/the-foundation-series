---
title: "Correlations in R"
author: "Arvind Venkatadri"
date: "2023-08-25"
output:
  html_document:
    theme: flatly
    toc: TRUE
    toc_float: TRUE
    toc_depth: 2
    df_print: paged
    number_sections: TRUE
    code_folding: show
    code_download: TRUE

---



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>We will craate Tables for Correlations, and graphs for Correlations in R. As always, we will consistently use the <a href="https://mosaic-web.org"><strong>Project Mosaic</strong></a> ecosystem of packages in R (<code>mosaic</code>, <code>mosaicData</code> and <code>ggformula</code>).</p>
<div id="note" class="illustration" style="background: beige">
<p>Note the standard method for all commands from the <code>mosaic</code> package:</p>
<p>goal( y ~ x | z, data = mydata, …)</p>
</div>
<div id="case-study--1-dataset-from-mosaicdata" class="section level2">
<h2>Case Study -1: Dataset from <code>mosaicData</code></h2>
<p>Let us inspect what datasets are available in the package <code>mosaicData</code>. Run this command in your Console:</p>
<pre class="r"><code># Run in Console
data(package = &quot;mosaicData&quot;)
</code></pre>
<p>The popup tab shows a lot of datasets we could use. Let us continue to use the famous <code>Galton</code> dataset and <code>inspect</code> it:</p>
<pre class="r"><code>data(&quot;Galton&quot;)
inspect(Galton)
#&gt; 
#&gt; categorical variables:  
#&gt;     name  class levels   n missing
#&gt; 1 family factor    197 898       0
#&gt; 2    sex factor      2 898       0
#&gt;                                    distribution
#&gt; 1 185 (1.7%), 166 (1.2%), 66 (1.2%) ...        
#&gt; 2 M (51.8%), F (48.2%)                         
#&gt; 
#&gt; quantitative variables:  
#&gt;     name   class min Q1 median   Q3  max      mean       sd   n missing
#&gt; 1 father numeric  62 68   69.0 71.0 78.5 69.232851 2.470256 898       0
#&gt; 2 mother numeric  58 63   64.0 65.5 70.5 64.084410 2.307025 898       0
#&gt; 3 height numeric  56 64   66.5 69.7 79.0 66.760690 3.582918 898       0
#&gt; 4  nkids integer   1  4    6.0  8.0 15.0  6.135857 2.685156 898       0</code></pre>
<p>The <code>inspect</code> command already gives us a series of statistical measures of different variables of interest. As discussed previously, we can retain the output of <code>inspect</code> and use it in our reports: (there are ways of dressing up these tables too)</p>
<pre class="r"><code>
galton_describe &lt;- inspect(Galton)

galton_describe$categorical
#&gt; # A tibble: 2 × 6
#&gt;   name   class  levels     n missing distribution                               
#&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;                                      
#&gt; 1 family factor    197   898       0 &quot;185 (1.7%), 166 (1.2%), 66 (1.2%) ...    …
#&gt; 2 sex    factor      2   898       0 &quot;M (51.8%), F (48.2%)                     …
galton_describe$quantitative
#&gt; # A tibble: 4 × 11
#&gt;   name   class     min    Q1 median    Q3   max  mean    sd     n missing
#&gt; * &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;
#&gt; 1 father numeric    62    68   69    71    78.5 69.2   2.47   898       0
#&gt; 2 mother numeric    58    63   64    65.5  70.5 64.1   2.31   898       0
#&gt; 3 height numeric    56    64   66.5  69.7  79   66.8   3.58   898       0
#&gt; 4 nkids  integer     1     4    6     8    15    6.14  2.69   898       0</code></pre>
<p>Try <code>help("Galton")</code> in your Console. The dataset is described as:</p>
<blockquote>
<p>A data frame with 898 observations on the following variables.<br />
- <code>family</code> a factor with levels for each family<br />
- <code>father</code> the father’s height (in inches)<br />
- <code>mother</code> the mother’s height (in inches)<br />
- <code>sex</code> the child’s sex: F or M<br />
- <code>height</code> the child’s height as an adult (in inches)<br />
- <code>nkids</code> the number of adult children in the family, or, at least, the number whose heights Galton recorded.</p>
</blockquote>
<p>There is a lot of Description generated by the <code>mosaic::inspect()</code> command !
What can we say about the dataset and its variables? How big is the dataset? How many variables? What types are they, Quant or Qual? If they are Qual, what are the <em>levels</em>? Are they <em>ordered</em> levels? Discuss!</p>
</div>
<div id="correlations-and-plots" class="section level2">
<h2>Correlations and Plots</h2>
<p>What Questions might we have, that we could answer with a Statistical Measure, or Correlation chart?</p>
<p>Q.1 Which are the variables that have significant pair-wise correlations? What polarity are these correlations?</p>
<pre class="r"><code>

# Pulling out the list of Quant variables from NHANES
galton_quant &lt;- galton_describe$quantitative
galton_quant$name
#&gt; [1] &quot;father&quot; &quot;mother&quot; &quot;height&quot; &quot;nkids&quot;

GGally::ggpairs(
  Galton,
  columns = c(&quot;father&quot;, &quot;mother&quot;, &quot;height&quot;, &quot;nkids&quot;),
  diag = list(&quot;densityDiag&quot;),
  title = &quot;Galton Data Correlations Plot&quot;
)</code></pre>
<p><img src="/courses/8-Data-Analytics/10-Descriptive-Analytics/30-Quant-Data-Correlations/files/correlations_files/figure-html/unnamed-chunk-4-1.png" width="672" />
Can we plot a Correlogram for this dataset?</p>
<pre class="r"><code>#library(corrplot)

galton_num_var &lt;- Galton %&gt;% select(father, mother, height, nkids)
galton_cor &lt;- cor(galton_num_var)
galton_correlogram &lt;- galton_cor %&gt;%
  corrplot(method = &quot;ellipse&quot;,
           type = &quot;lower&quot;,
           main = &quot;Correlogram for Galton dataset&quot;)</code></pre>
<p><img src="/courses/8-Data-Analytics/10-Descriptive-Analytics/30-Quant-Data-Correlations/files/correlations_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>galton_correlogram
#&gt; $corr
#&gt;             father      mother     height       nkids
#&gt; father  1.00000000  0.07366461  0.2753548 -0.16002294
#&gt; mother  0.07366461  1.00000000  0.2016549 -0.02002964
#&gt; height  0.27535483  0.20165489  1.0000000 -0.12691012
#&gt; nkids  -0.16002294 -0.02002964 -0.1269101  1.00000000
#&gt; 
#&gt; $corrPos
#&gt;     xName  yName x y        corr
#&gt; 1  father father 1 4  1.00000000
#&gt; 2  father mother 1 3  0.07366461
#&gt; 3  father height 1 2  0.27535483
#&gt; 4  father  nkids 1 1 -0.16002294
#&gt; 5  mother mother 2 3  1.00000000
#&gt; 6  mother height 2 2  0.20165489
#&gt; 7  mother  nkids 2 1 -0.02002964
#&gt; 8  height height 3 2  1.00000000
#&gt; 9  height  nkids 3 1 -0.12691012
#&gt; 10  nkids  nkids 4 1  1.00000000
#&gt; 
#&gt; $arg
#&gt; $arg$type
#&gt; [1] &quot;lower&quot;</code></pre>
<p>Clearly <code>height</code> is positvely correlated to <code>father</code> and <code>mother</code>; interestingly, <code>height</code> is negatively correlated ( slightly) with <code>nkids</code>.</p>
<p>Q.2: Let us confirm with a test:</p>
<pre class="r"><code>mosaic::cor_test(height ~ father, data = Galton)
#&gt; 
#&gt; 	Pearson&#39;s product-moment correlation
#&gt; 
#&gt; data:  height and father
#&gt; t = 8.5737, df = 896, p-value &lt; 2.2e-16
#&gt; alternative hypothesis: true correlation is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  0.2137851 0.3347455
#&gt; sample estimates:
#&gt;       cor 
#&gt; 0.2753548</code></pre>
<pre class="r"><code>mosaic::cor_test(height ~ mother, data = Galton)
#&gt; 
#&gt; 	Pearson&#39;s product-moment correlation
#&gt; 
#&gt; data:  height and mother
#&gt; t = 6.1628, df = 896, p-value = 1.079e-09
#&gt; alternative hypothesis: true correlation is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  0.1380554 0.2635982
#&gt; sample estimates:
#&gt;       cor 
#&gt; 0.2016549</code></pre>
<p>Q.3 What does this correlation look when split by <code>sex</code> of Child?</p>
<pre class="r"><code>
# For the sons
cor_test(height ~ father, data = Galton %&gt;% filter(sex == &quot;M&quot;))
#&gt; 
#&gt; 	Pearson&#39;s product-moment correlation
#&gt; 
#&gt; data:  height and father
#&gt; t = 9.1498, df = 463, p-value &lt; 2.2e-16
#&gt; alternative hypothesis: true correlation is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  0.3114667 0.4656805
#&gt; sample estimates:
#&gt;       cor 
#&gt; 0.3913174
cor_test(height ~ mother, data = Galton %&gt;% filter(sex == &quot;M&quot;))
#&gt; 
#&gt; 	Pearson&#39;s product-moment correlation
#&gt; 
#&gt; data:  height and mother
#&gt; t = 7.628, df = 463, p-value = 1.367e-13
#&gt; alternative hypothesis: true correlation is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  0.2508178 0.4125305
#&gt; sample estimates:
#&gt;       cor 
#&gt; 0.3341309

# For the daughters
cor_test(height ~ father, data = Galton %&gt;% filter(sex == &quot;F&quot;))
#&gt; 
#&gt; 	Pearson&#39;s product-moment correlation
#&gt; 
#&gt; data:  height and father
#&gt; t = 10.719, df = 431, p-value &lt; 2.2e-16
#&gt; alternative hypothesis: true correlation is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  0.3809944 0.5300812
#&gt; sample estimates:
#&gt;       cor 
#&gt; 0.4587605
cor_test(height ~ mother, data = Galton %&gt;% filter(sex == &quot;F&quot;))
#&gt; 
#&gt; 	Pearson&#39;s product-moment correlation
#&gt; 
#&gt; data:  height and mother
#&gt; t = 6.8588, df = 431, p-value = 2.421e-11
#&gt; alternative hypothesis: true correlation is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  0.2261463 0.3962226
#&gt; sample estimates:
#&gt;       cor 
#&gt; 0.3136984</code></pre>
<p>Q.4. How can we show this correlation in a set of Scatter Plots + Regression Lines? Can we recreate Galton’s famous diagram?</p>
<pre class="r"><code># For the sons
gf_point(height ~ father, data = Galton %&gt;% filter(sex == &quot;M&quot;)) %&gt;% gf_smooth(method = &quot;lm&quot;)</code></pre>
<p><img src="/courses/8-Data-Analytics/10-Descriptive-Analytics/30-Quant-Data-Correlations/files/correlations_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>gf_point(height ~ mother, data = Galton %&gt;% filter(sex == &quot;M&quot;)) %&gt;% gf_smooth(method = &quot;lm&quot;)</code></pre>
<p><img src="/courses/8-Data-Analytics/10-Descriptive-Analytics/30-Quant-Data-Correlations/files/correlations_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<pre class="r"><code>
# For the daughters
gf_point(height ~ father, data = Galton %&gt;% filter(sex == &quot;F&quot;)) %&gt;% gf_smooth(method = &quot;lm&quot;)</code></pre>
<p><img src="/courses/8-Data-Analytics/10-Descriptive-Analytics/30-Quant-Data-Correlations/files/correlations_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<pre class="r"><code>gf_point(height ~ mother, data = Galton %&gt;% filter(sex == &quot;F&quot;)) %&gt;% gf_smooth(method = &quot;lm&quot;)</code></pre>
<p><img src="/courses/8-Data-Analytics/10-Descriptive-Analytics/30-Quant-Data-Correlations/files/correlations_files/figure-html/unnamed-chunk-9-4.png" width="672" />
An approximation to Galton’s famous plot (see Wikipedia):</p>
<pre class="r"><code>gf_point(height ~ (father + mother)/2, data = Galton) %&gt;% gf_smooth(method = &quot;lm&quot;) %&gt;% gf_density_2d(n = 8) %&gt;% gf_abline(slope = 1)</code></pre>
<p><img src="/courses/8-Data-Analytics/10-Descriptive-Analytics/30-Quant-Data-Correlations/files/correlations_files/figure-html/unnamed-chunk-10-1.png" width="672" />
How would you interpret this plot?</p>
</div>
<div id="case-study--2-dataset-from-nhanes" class="section level2">
<h2>Case Study -2: Dataset from <code>NHANES</code></h2>
<p>We will “live code” this in class!</p>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>We have a decent Correlations related <em>workflow</em> in R:<br />
- load the dataset<br />
- <code>inspect</code> the dataset, identify Quant and Qual variables<br />
- Develop Pair-Wise plots + Correlations using <code>GGally::ggpairs()</code><br />
- Develop Correlogram <code>corrplot::corrplot</code><br />
- Check everything with a <code>cor_test</code><br />
- Plot scatter plots using <code>gf_point</code> if needed.<br />
- Add extra lines using <code>gf_abline()</code> to compare hypotheses that you may have.</p>
</div>
